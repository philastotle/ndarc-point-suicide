---
title: "Suicide Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
# Libs
library(data.table)
library(ggplot2)
library(ggrepel)
library(plotly)
library(ROCR)
library(MASS)
library(randomForest)

# load data
baseline <- read.csv("../data/t1_beta.csv")
suicide_thoughts_df <- subset(baseline, Suicide_Thoughts_12m == "Yes")
core <- read.csv("../data/core_labels.csv")
```

# Suicide Prediction Exploration

The two main variables we are interested in predicting are "Suicide_Thoughts_12m" &  "Suicide_Attempt_12M".

## Number of suicide attempters
```{r}
overdose_calc <- function(data, desired_wave, option = 1){
  # 1. subset to desired year
  # 2. Subset based on those who have overdosed
  # 3. Use unique to get a set of the list of p
  tmp <- subset(data, wave==desired_wave)
  if(option == 1){
    tmp <- subset(tmp, Suicide_Thoughts_12m == "Yes")
  } else {
    tmp <- subset(tmp, Suicide_Attempt_12M == "Yes")
  }
  
  participants <- unique(tmp$Participant_ID)
  
return(participants)
}

unique_calc <- function(option){
  t1_participants <- overdose_calc(data=core, desired_wave="Baseline", option=option)
  t3_participants <- overdose_calc(data=core, desired_wave="Year 1", option=option)
  t4_participants <- overdose_calc(data=core, desired_wave="Year 2", option=option)
  t5_participants <- overdose_calc(data=core, desired_wave="Year 3", option=option)
  t6_participants <- overdose_calc(data=core, desired_wave="Year 4", option=option)
  t7_participants <- overdose_calc(data=core, desired_wave="Year 5", option=option)
  
  all_participants <- c(t1_participants,
                        t3_participants,
                        t4_participants,
                        t5_participants,
                        t6_participants,
                        t7_participants)
  
  all_participants <- unique(all_participants)
  if(option ==1){
      cat("\nThere are ", length(all_participants), 
      "number of different people who have experienced suicidal thoughts across the 6 years.")
  } else {
      cat("\nThere are ", length(all_participants), 
      " different people who have experienced suicide attempts across the 6 years.") 
  }

  return(all_participants)
}

all_participants <- unique_calc(option=1)
all_participants <- unique_calc(option=2)
```

# 1. Descriptive Statistics

## A. Demographics
### Age
```{r}
Female_Age_Mean <- mean(suicide_thoughts_df[suicide_thoughts_df$sex == 'Female', 'Actual_age'])
Male_Age_Mean <- mean(suicide_thoughts_df[suicide_thoughts_df$sex == 'Male', 'Actual_age'])

ggplotly(
ggplot(data = suicide_thoughts_df, aes(x = Actual_age, fill = sex)) + 
  ggtitle("Distribution of respondents by age") + 
  labs(x = "Age", y = "Number of respondents") +
  geom_histogram(bins = 100
                 , alpha = 0.7
                 , binwidth = 1
                 , col = 'black') + 
  scale_fill_manual(values=c("red", "sky blue")) +
  scale_x_continuous(breaks=seq(0 , max(suicide_thoughts_df[,'Actual_age']), 5)) +
  scale_y_continuous(breaks=seq(0 , 50, 2 )) + 
  geom_vline(aes(xintercept = Female_Age_Mean), colour="red") +
  geom_vline(aes(xintercept = Male_Age_Mean), colour="sky blue")
)
```

### Density
```{r}
ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = Actual_age, fill = sex)) + 
    ggtitle("Density of distribution (respondents by age)") + 
    labs(x = "Age", y = "Number of respondents") +
    geom_density(alpha = 0.7
                   , binwidth = 1
                   , position="identity"
                   , col = 'black') + 
    scale_fill_manual(values=c("red", "sky blue")) +
    scale_x_continuous(breaks=seq(0 , max(suicide_thoughts_df[,'Actual_age']), 5))
)
```

### Country of Birth
```{r}
ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = cob, fill = cob)) + 
    ggtitle("Respondents by Race") + 
    labs(x = "Race", y = "Number of respondents") +
    geom_bar(alpha = 0.7
                 , position="identity"
                 , col = 'black')
)

ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = cob, y = Actual_age, fill = cob)) + 
    ggtitle("Respondents by Race and Age") + 
    labs(x = "Race", y = "Age") +
    geom_boxplot(alpha = 0.7
                 , col = 'black') + 
    scale_y_continuous(breaks=seq(0 , max(suicide_thoughts_df[, 'Actual_age']), 5))
)
```

### Bodyweight
```{r}
ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = bmicat, fill = bmicat)) + 
    ggtitle("Bodyweight category by gender") + 
    labs(x = "Bodyweight category", y = "Number of respondents") +
    geom_bar(alpha = 0.7
             , position="identity"
             , col = 'black') + 
    facet_grid(.~sex)
)
```

## Marital Status
```{r}
ggplot(data = suicide_thoughts_df, aes(x = MarritalStatus, fill = MarritalStatus)) + 
  ggtitle("Employment category by sex") + 
  labs(x = "Employment category", y = "Number of respondents") +
  geom_bar(alpha = 0.7
           , position="identity"
           , col = 'black') + 
  facet_grid(.~sex) +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5, size=7))
```
## Education
```{r}
ggplot(data = suicide_thoughts_df, aes(x = edu, fill = edu)) + 
  ggtitle("Education Attainment by sex") + 
  labs(x = "Education category", y = "Number of respondents") +
  geom_bar(alpha = 0.7
           , position="identity"
           , col = 'black') + 
  facet_grid(.~sex) +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5, size=7))
```

### Income by employment
```{r}
ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = Employ, y = income_wk, fill = Employ)) + 
    ggtitle("Income by Employment") + 
    labs(x = "employment", y = "max_income") +
    geom_boxplot(alpha = 0.7
                 , col = 'black'
                 , show.legend = F) + 
        theme(axis.text.x  = element_text(angle=45, vjust=0.5, size=7))
)
```


### Income & Suicide attempts
```{r}
ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = Employ, fill = Suicide_Attempt_12M)) + 
      ggtitle("Employment + AttemptSuicide") + 
  labs(x = "Number of friends", y = "Share of respondents") +
    geom_bar(alpha = 0.7
             , position="fill"
             , col = 'black') + 
    scale_fill_manual(values=c("sky blue", "red")) + 
    theme(axis.text.x  = element_text(angle=45, vjust=0.5, size=8))
)
```

### Number of Co-habitants
```{r}
ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = Live_Count, fill = Live_Count)) + 
    ggtitle("Number of co-habitants") + 
    labs(x = "Count", y = "Number of respondents") +
    geom_bar(alpha = 0.7
             , position="identity"
             , col = 'black') + 
    facet_grid(.~sex)
)
```

### Suicide attempts and number of Cohabitants
```{r}
suicide_thoughts_df$Suicide_Attempt_12M[suicide_thoughts_df$Suicide_Attempt_12M =="Not Applicable"] <- NA
suicide_thoughts_df$Suicide_Attempt_12M[suicide_thoughts_df$Suicide_Attempt_12M =="Refuse to Answer"] <- NA
suicide_thoughts_df$Suicide_Attempt_12M[suicide_thoughts_df$Suicide_Attempt_12M ==" "] <- NA
suicide_thoughts_df$Suicide_Attempt_12M <- factor(suicide_thoughts_df$Suicide_Attempt_12M)

ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = Live_Count, fill = Suicide_Attempt_12M)) + ggtitle("Number of friends + AttemptSuicide") + 
    labs(x = "Number of friends", y = "Share of respondents") +
    geom_bar(alpha = 0.7
             , position="fill"
             , col = 'black') + 
    scale_fill_manual(values=c("sky blue", "red", "green", "orange"))
)
```
## Pain
```{r}
# BPI_Score
# number of chronic conditions
# Washington group

ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = BPI_PScore, fill = BPI_PScore)) + 
      ggtitle("Employment + AttemptSuicide") + 
  labs(x = "Number of friends", y = "Share of respondents") +
    geom_histogram() +  facet_grid(.~sex)
)
# BPI_PScore_five

ggplot(data = suicide_thoughts_df, aes(x = BPI_PScore_five, fill = BPI_PScore_five)) + 
  ggtitle("Education Attainment by sex") + 
  labs(x = "Education category", y = "Number of respondents") +
  geom_bar(alpha = 0.7
           , position="identity"
           , col = 'black') + 
  facet_grid(.~sex) +
  theme(axis.text.x  = element_text(angle=90, vjust=0.5, size=7))
```

## Physical Function
```{r}
# BPI inventory
# Exercise
# Falls
# Sleep
# Coping and pain
```

## Treatment Medications
```{r}
# Beliefs about medicines
```

## Quality of Life
```{r}
# WHO_QOL
```

## Mental Health
### Depression
```{r}
suicide_thoughts_df$PHQ9_Mod_sev[suicide_thoughts_df$PHQ9_Mod_sev == 1 ] <- "Yes"
suicide_thoughts_df$PHQ9_Mod_sev[suicide_thoughts_df$PHQ9_Mod_sev == -0 ] <- "No"

ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = Live_Count, fill = PHQ9_Mod_sev )) + 
    ggtitle("Number of cohabitants + Moderate to Severe Depression (PHQ9)") + 
    labs(x = "Number of cohabitants", y = "Share of respondents") +
    geom_bar(alpha = 0.7
             , position="fill"
             , col = 'black') + 
    scale_fill_manual(values=c("sky blue", "red"))
)
```


### Anxiety
```{r}
ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = Live_Count, fill = GADMod2Sev)) + 
    ggtitle("Number of cohabitants + Moderate to Severe GAD") + 
    labs(x = "Number of cohabitants", y = "Share of respondents") +
    geom_bar(alpha = 0.7
             , position="fill"
             , col = 'black') + 
    scale_fill_manual(values=c("sky blue", "red"))
)
```

### Social Anxiety
```{r}
# SIAS_cutoff
ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = Live_Count, fill = SIAS_cutoff)) + 
    ggtitle("Number of cohabitants + Social Interaction Anxiety") + 
    labs(x = "Number of cohabitants", y = "Share of respondents") +
    geom_bar(alpha = 0.7
             , position="fill"
             , col = 'black') + 
    scale_fill_manual(values=c("sky blue", "red"))
)
```

### Social Phobia
```{r}
# SPS_cutoff
suicide_thoughts_df$SPS_cutoff[suicide_thoughts_df$SPS_cutoff == " "] <- NA

ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = Live_Count, fill = SPS_cutoff)) + 
    ggtitle("Number of cohabitants + Social Phobia") + 
    labs(x = "Number of cohabitants", y = "Share of respondents") +
    geom_bar(alpha = 0.7
             , position="fill"
             , col = 'black') + 
    scale_fill_manual(values=c("sky blue", "red"))
)
```

### Agoraphobia
```{r}
# Current_Agoraphobia
ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = Live_Count, fill = Current_Agoraphobia)) + 
    ggtitle("Number of cohabitants + Current_Agoraphobia") + 
    labs(x = "Number of cohabitants", y = "Share of respondents") +
    geom_bar(alpha = 0.7
             , position="fill"
             , col = 'black') + 
    scale_fill_manual(values=c("sky blue", "red"))
)
```

### Boderline Personality Disorder
```{r}
# Borderline

ggplotly(
  ggplot(data = suicide_thoughts_df, aes(x = Live_Count, fill = Borderline)) + 
    ggtitle("Number of cohabitants + Borderline") + 
    labs(x = "Number of cohabitants", y = "Share of respondents") +
    geom_bar(alpha = 0.7
             , position="fill"
             , col = 'black') + 
    scale_fill_manual(values=c("sky blue", "red"))
)
```

